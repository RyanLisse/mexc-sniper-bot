# Test info

- Name: Simplified Authentication Flow >> User registration flow
- Location: /Users/neo/Developer/mexc-sniper-bot/all-tests/e2e-tests/simplified-auth-flow.spec.ts:85:7

# Error details

```
Error: page.waitForURL: Test timeout of 60000ms exceeded.
=========================== logs ===========================
waiting for navigation to "**/dashboard" until "load"
============================================================
    at /Users/neo/Developer/mexc-sniper-bot/all-tests/e2e-tests/simplified-auth-flow.spec.ts:123:16
```

# Page snapshot

```yaml
- heading "MEXC Sniper Bot" [level=1]
- paragraph: AI-powered cryptocurrency trading platform
- text: Create Account Create your account to start trading with AI-powered strategies Full Name
- textbox "Full Name"
- text: Email Address
- textbox "Email Address"
- text: Password
- textbox "Password"
- button
- button "Create Account"
- paragraph: Already have an account?
- button "Sign in here"
- link "← Back to dashboard":
  - /url: /dashboard
- paragraph: Your data is encrypted and stored securely
- link "← Back to Dashboard":
  - /url: /
- button "Open Tanstack query devtools":
  - img
- alert
- button "Open Next.js Dev Tools":
  - img
```

# Test source

```ts
   23 |     // Clean up test user if created
   24 |     if (userId) {
   25 |       try {
   26 |         await db.delete(user).where(eq(user.id, userId));
   27 |         console.log(`Cleaned up test user: ${userId}`);
   28 |       } catch (error) {
   29 |         console.warn('Cleanup error:', error);
   30 |       }
   31 |     }
   32 |   });
   33 |
   34 |   test('Homepage loads correctly for unauthenticated users', async ({ page }) => {
   35 |     console.log('Testing homepage load for unauthenticated users');
   36 |     
   37 |     // Wait for page to load completely
   38 |     await page.waitForLoadState('networkidle');
   39 |     
   40 |     // Take screenshot for debugging
   41 |     await page.screenshot({ path: 'debug-homepage.png', fullPage: true });
   42 |     
   43 |     // Check if page contains loading state
   44 |     const loadingElement = page.locator('text=Loading...');
   45 |     if (await loadingElement.isVisible()) {
   46 |       console.log('Page is in loading state, waiting...');
   47 |       await loadingElement.waitFor({ state: 'detached', timeout: 10000 });
   48 |     }
   49 |     
   50 |     // Wait for the main heading to appear
   51 |     await page.waitForSelector('h1', { timeout: 10000 });
   52 |     
   53 |     // Verify homepage content
   54 |     await expect(page.locator('h1')).toContainText('MEXC Sniper Bot');
   55 |     await expect(page.locator('text=Get Started')).toBeVisible();
   56 |     await expect(page.locator('text=Sign In')).toBeVisible();
   57 |     
   58 |     console.log('Homepage verification passed');
   59 |   });
   60 |
   61 |   test('Navigation to auth page works', async ({ page }) => {
   62 |     console.log('Testing navigation to auth page');
   63 |     
   64 |     // Wait for page to load
   65 |     await page.waitForLoadState('networkidle');
   66 |     
   67 |     // Skip loading state if present
   68 |     const loadingElement = page.locator('text=Loading...');
   69 |     if (await loadingElement.isVisible()) {
   70 |       await loadingElement.waitFor({ state: 'detached', timeout: 10000 });
   71 |     }
   72 |     
   73 |     // Click "Get Started" button
   74 |     await page.click('text=Get Started');
   75 |     
   76 |     // Wait for navigation
   77 |     await page.waitForURL('**/auth', { timeout: 10000 });
   78 |     
   79 |     // Verify we're on the auth page
   80 |     await expect(page).toHaveURL(/.*\/auth$/);
   81 |     
   82 |     console.log('Navigation to auth page successful');
   83 |   });
   84 |
   85 |   test('User registration flow', async ({ page }) => {
   86 |     console.log('Testing user registration');
   87 |     
   88 |     // Navigate to auth page
   89 |     await page.goto('http://localhost:3008/auth');
   90 |     await page.waitForLoadState('networkidle');
   91 |     
   92 |     // Take screenshot of auth page
   93 |     await page.screenshot({ path: 'debug-auth-page.png', fullPage: true });
   94 |     
   95 |     // Look for registration form elements
   96 |     const emailInput = page.locator('input[name="email"], input[type="email"]');
   97 |     const passwordInput = page.locator('input[name="password"], input[type="password"]');
   98 |     
   99 |     // Wait for form to be ready
  100 |     await emailInput.waitFor({ timeout: 10000 });
  101 |     
  102 |     // Fill registration form
  103 |     await emailInput.fill(TEST_EMAIL);
  104 |     await passwordInput.fill(TEST_PASSWORD);
  105 |     
  106 |     // Look for name and username fields if they exist
  107 |     const nameInput = page.locator('input[name="name"]');
  108 |     const usernameInput = page.locator('input[name="username"]');
  109 |     
  110 |     if (await nameInput.isVisible()) {
  111 |       await nameInput.fill('Test User');
  112 |     }
  113 |     
  114 |     if (await usernameInput.isVisible()) {
  115 |       await usernameInput.fill(TEST_USERNAME);
  116 |     }
  117 |     
  118 |     // Find and click submit button
  119 |     const submitButton = page.locator('button[type="submit"]:has-text("Sign Up"), button:has-text("Register"), button:has-text("Create Account")');
  120 |     await submitButton.click();
  121 |     
  122 |     // Wait for registration to complete
> 123 |     await page.waitForURL('**/dashboard', { timeout: 15000 });
      |                ^ Error: page.waitForURL: Test timeout of 60000ms exceeded.
  124 |     
  125 |     // Verify we're on dashboard
  126 |     await expect(page).toHaveURL(/.*\/dashboard$/);
  127 |     
  128 |     // Get user ID for cleanup
  129 |     const users = await db.select().from(user).where(eq(user.email, TEST_EMAIL));
  130 |     if (users.length > 0) {
  131 |       userId = users[0].id;
  132 |       console.log(`User registered successfully with ID: ${userId}`);
  133 |     }
  134 |     
  135 |     console.log('Registration flow completed successfully');
  136 |   });
  137 |
  138 |   test('Authentication state persistence', async ({ page, context }) => {
  139 |     console.log('Testing authentication state persistence');
  140 |     
  141 |     // Register a user first
  142 |     await page.goto('http://localhost:3008/auth');
  143 |     await page.waitForLoadState('networkidle');
  144 |     
  145 |     // Fill and submit registration
  146 |     await page.fill('input[name="email"], input[type="email"]', TEST_EMAIL);
  147 |     await page.fill('input[name="password"], input[type="password"]', TEST_PASSWORD);
  148 |     
  149 |     const nameInput = page.locator('input[name="name"]');
  150 |     if (await nameInput.isVisible()) {
  151 |       await nameInput.fill('Test User');
  152 |     }
  153 |     
  154 |     const usernameInput = page.locator('input[name="username"]');
  155 |     if (await usernameInput.isVisible()) {
  156 |       await usernameInput.fill(TEST_USERNAME);
  157 |     }
  158 |     
  159 |     await page.click('button[type="submit"]:has-text("Sign Up"), button:has-text("Register")');
  160 |     await page.waitForURL('**/dashboard', { timeout: 15000 });
  161 |     
  162 |     // Get user ID for cleanup
  163 |     const users = await db.select().from(user).where(eq(user.email, TEST_EMAIL));
  164 |     if (users.length > 0) {
  165 |       userId = users[0].id;
  166 |     }
  167 |     
  168 |     // Now test navigation - authenticated users should be redirected to dashboard
  169 |     await page.goto('http://localhost:3008');
  170 |     await page.waitForURL('**/dashboard', { timeout: 10000 });
  171 |     
  172 |     // Verify redirect happened
  173 |     await expect(page).toHaveURL(/.*\/dashboard$/);
  174 |     
  175 |     console.log('Authentication state persistence verified');
  176 |   });
  177 |
  178 |   test('Network request optimization check', async ({ page }) => {
  179 |     console.log('Testing for redundant network requests');
  180 |     
  181 |     const requests: any[] = [];
  182 |     
  183 |     // Monitor network requests
  184 |     page.on('request', request => {
  185 |       requests.push({
  186 |         url: request.url(),
  187 |         method: request.method(),
  188 |         resourceType: request.resourceType()
  189 |       });
  190 |     });
  191 |     
  192 |     // Load homepage
  193 |     await page.goto('http://localhost:3008');
  194 |     await page.waitForLoadState('networkidle');
  195 |     
  196 |     // Wait a bit more for any delayed requests
  197 |     await page.waitForTimeout(3000);
  198 |     
  199 |     // Analyze requests
  200 |     const authRequests = requests.filter(r => r.url.includes('/api/auth/'));
  201 |     const sessionRequests = authRequests.filter(r => r.url.includes('session') || r.url.includes('get-session'));
  202 |     const duplicateRequests = requests.filter((r, index, arr) => 
  203 |       arr.findIndex(req => req.url === r.url && req.method === r.method) !== index
  204 |     );
  205 |     
  206 |     console.log(`Total requests: ${requests.length}`);
  207 |     console.log(`Auth requests: ${authRequests.length}`);
  208 |     console.log(`Session requests: ${sessionRequests.length}`);
  209 |     console.log(`Duplicate requests: ${duplicateRequests.length}`);
  210 |     
  211 |     // Verify reasonable request counts
  212 |     expect(authRequests.length).toBeLessThan(10);
  213 |     expect(sessionRequests.length).toBeLessThan(5);
  214 |     expect(duplicateRequests.length).toBeLessThan(3);
  215 |     
  216 |     console.log('Network optimization check passed');
  217 |   });
  218 | });
```